import{a2 as W,l as d,C as $,J as q,q as J,b as m,h as s,j as w,w as C,v as e,t as i,F as I,i as G,e as K,d as b,f as O,z as Q,o as c}from"./app-pebjqkCD.js";import{M as X}from"./Map-DjgYGqph.js";import{u as Y}from"./trips-BVbkd_tG.js";import{u as ss}from"./vehicles-hQAbVoZ-.js";import{u as ts}from"./users-BKl8x4eE.js";import{u as es}from"./rates-Dmnqx1u6.js";import{u as os}from"./tags-Tukfb8ff.js";import"./index.esm-C_1aiQ0x.js";import{s as as,a as is}from"./index-CGjmJFsW.js";import{_ as ls}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./yup-locales.esm-DRsOkZ6u.js";const ns=W("trip",()=>{const r=d(null);return{tripData:r,setTripData:v=>{r.value={...r.value,...v},console.log("Datos guardados en store:",r.value)},clearTripData:()=>{r.value=null}}}),ds={class:"container-fluid py-4"},rs={class:"row"},cs={class:"col-md-6 pe-md-2"},ms={class:"card shadow-sm mb-4"},us={class:"card-body"},ps={class:"row"},vs={class:"col"},_s={class:"m-0 small"},fs={class:"timeline-event"},gs={class:"px-5"},hs={class:"col-12 mt-3"},ws={class:"d-flex align-items-center"},bs={class:"ms-2 fw-medium"},xs={class:"col-12"},ys={class:"card-body p-0"},Ts={class:"col-md-6 ps-md-2 mt-md-0"},ks={class:"card shadow-sm h-100"},Ms={class:"card-body d-flex flex-column align-items-center"},Ds={key:0,class:""},Cs={class:"user-info mb-4"},Is={class:"text-center mb-4"},Us={class:"user-image-container d-inline-block p-2"},Vs=["src","alt"],Rs={class:"d-block d-md-flex gap-5 text-center w-100"},Ns={class:""},As={class:"fw-medium"},Bs={class:""},Es={class:"fw-medium"},Hs={class:""},Ls={class:"fw-medium"},Fs={class:""},Ps={class:"fw-medium"},js={class:"col d-flex flex-column align-items-center"},zs={class:"fw-medium"},Ss={class:"vehicle-info mb-2 w-50"},Zs={class:"row row-cols-1 row-cols-sm-2 g-3 text-center"},Ws={class:"col"},$s={class:"fw-medium"},qs={class:"col"},Js={class:"fw-medium"},Gs={class:"col"},Ks={class:"fw-medium"},Os={class:"col"},Qs={class:"fw-medium"},Xs={class:"cost-info w-50 text-center m-3"},Ys={class:"d-flex justify-content-center gap-5"},st={class:"mb-1"},tt={class:"mb-1"},et={__name:"confirmationTrip",setup(r){ns();const u=d(null),p=d(null),v=d(!1),{getTagWithID:U,tag:x}=os(),{getRateWithId2:V,rate:y}=es(),{getTrip:R,trip:a,reservedTrip:N,getTagTrips:A,tags:h}=Y(),{getUser:B,user:l}=ts(),{getVehicle:E,vehicle:_}=ss(),T=$(),H=Q(),k=T.params.id,L=T.params.seats,F=q(),f=d(null),M=d([]);J(async()=>{try{if(await R(k),console.log("trip",a.value),await B(a.value.user_id),await E(a.value.vehicle_id),await V(a.value.user_id),y.value?f.value=y.value.pivot.rate:f.value=0,u.value=a.value.start_point,p.value=a.value.end_point,v.value=!0,await A(k),h.value&&h.value.length>0)for(const o of h.value)await U(o),x.value&&M.value.push(x.value.tag_name);else console.log("No hay tags disponibles")}catch(o){console.error("Error al cargar los datos:",o)}});const P=d(null),D=d(null);P.value=a.price;const j=o=>{const t=a.value.available_seats;return D.value=(o/t).toFixed(2),`${D.value} €`};function z(o){var t,g;return[{location:(t=o.start_point)==null?void 0:t.address,time:o.departure_time},{location:(g=o.end_point)==null?void 0:g.address,time:o.arrival_time}]}const S=async()=>{try{const o=d({});o.value={trip_id:a.value.id,user_id:a.value.user_id,seats_reserved:L,reservation_date:new Date,price:a.value.price},await N(o),H.push({name:"ManageTrips"})}catch(o){console.log("Error Reservando el asiento:",o),F.add({severity:"error",summary:"Error",detail:"No se pudo guardar el asiento.",life:3e3})}};return(o,t)=>{const g=O("Toast");return c(),m(I,null,[s("div",ds,[s("div",rs,[s("div",cs,[s("div",ms,[s("div",us,[s("div",ps,[s("div",vs,[w(e(as),{value:z(e(a)),layout:"horizontal",align:"top",class:"w-100"},{marker:C(n=>[t[3]||(t[3]=s("i",{class:"pi pi-map-marker p-2",style:{"font-size":"1.5rem"}},null,-1)),s("p",_s,i(n.item.time),1)]),content:C(n=>[s("div",fs,[s("p",gs,i(n.item.location),1)])]),_:1},8,["value"])]),s("div",hs,[s("div",ws,[t[4]||(t[4]=s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"28",height:"28",fill:"#0d6efd",viewBox:"0 0 256 256"},[s("path",{d:"M224,232a8,8,0,0,1-8,8H112a8,8,0,0,1,0-16H216A8,8,0,0,1,224,232Zm0-72v32a16,16,0,0,1-16,16H114.11a15.93,15.93,0,0,1-14.32-8.85l-58.11-116a16.1,16.1,0,0,1,0-14.32l22.12-44A16,16,0,0,1,85,17.56l33.69,14.22.47.22a16,16,0,0,1,7.15,21.46,1.51,1.51,0,0,1-.11.22L112,80l31.78,64L208,144A16,16,0,0,1,224,160Zm-16,0H143.77a15.91,15.91,0,0,1-14.31-8.85l-31.79-64a16.07,16.07,0,0,1,0-14.29l.12-.22L112,46.32,78.57,32.21A4.84,4.84,0,0,1,78.1,32L56,76,114.1,192H208Z"})],-1)),s("span",bs,i(e(a).available_seats),1)])]),s("div",xs,[(c(!0),m(I,null,G(M.value,(n,Z)=>(c(),m("span",{key:Z,class:"badge rounded-pill bg-light text-dark border me-1 mb-1"},i(n),1))),128))])])])]),s("div",ys,[v.value?(c(),K(X,{key:0,origin:u.value,"onUpdate:origin":t[0]||(t[0]=n=>u.value=n),destination:p.value,"onUpdate:destination":t[1]||(t[1]=n=>p.value=n),onUpdateMapsInfo:o.handleMapsInfo,class:"map-container"},null,8,["origin","destination","onUpdateMapsInfo"])):b("",!0)])]),s("div",Ts,[s("div",ks,[s("div",Ms,[e(l)&&e(l).length>0?(c(),m("div",Ds,[s("div",null,[s("div",Cs,[t[10]||(t[10]=s("h3",{class:"fw-bold text-center mb-3"}," Información del Usuario ",-1)),s("div",Is,[s("div",Us,[e(l)[0].media.length>0?(c(),m("img",{key:0,src:e(l)[0].media&&e(l)[0].media.length>0?e(l)[0].media[0].original_url:"/images/default-avatar.png",alt:e(l)[0].name,class:"rounded-circle user-avatar mb-1"},null,8,Vs)):b("",!0)])]),s("div",Rs,[s("div",Ns,[t[5]||(t[5]=s("p",{class:"text-muted mb-1"}," Usuario ",-1)),s("p",As,i(e(l)[0].alias),1)]),s("div",Bs,[t[6]||(t[6]=s("p",{class:"text-muted mb-1"}," Nombre ",-1)),s("p",Es,i(e(l)[0].name),1)]),s("div",Hs,[t[7]||(t[7]=s("p",{class:"text-muted mb-1"}," Apellidos ",-1)),s("p",Ls,i(e(l)[0].surname1??"")+" "+i(e(l)[0].surname2??""),1)]),s("div",Fs,[t[8]||(t[8]=s("p",{class:"text-muted mb-1"}," Correo ",-1)),s("p",Ps,i(e(l)[0].email),1)]),s("div",js,[t[9]||(t[9]=s("p",{class:"text-muted mb-1"}," Rating ",-1)),s("p",zs,[w(e(is),{modelValue:f.value,"onUpdate:modelValue":t[2]||(t[2]=n=>f.value=n),disabled:""},null,8,["modelValue"])])])])])])])):b("",!0),s("div",Ss,[t[15]||(t[15]=s("h3",{class:"fw-bold text-center mb-3"},"Vehículo",-1)),s("div",Zs,[s("div",Ws,[t[11]||(t[11]=s("p",{class:"text-muted mb-1"},"Marca",-1)),s("p",$s,i(e(_).brand),1)]),s("div",qs,[t[12]||(t[12]=s("p",{class:"text-muted mb-1"},"Modelo",-1)),s("p",Js,i(e(_).model),1)]),s("div",Gs,[t[13]||(t[13]=s("p",{class:"text-muted mb-1"},"Placa",-1)),s("p",Ks,i(e(_).plate),1)]),s("div",Os,[t[14]||(t[14]=s("p",{class:"text-muted mb-1"},"Tipo",-1)),s("p",Qs,i(e(_).fuel_type),1)])])]),s("div",Xs,[t[18]||(t[18]=s("h3",{class:"fw-bold mb-3"},"Coste",-1)),s("div",Ys,[s("div",null,[s("h4",st,i(j(e(a).price)),1),t[16]||(t[16]=s("p",{class:"text-muted fw-bold fs-6"}," Coste mínimo ",-1))]),s("div",null,[s("h4",tt,i(e(a).price)+" €",1),t[17]||(t[17]=s("p",{class:"text-muted fw-bold fs-6"}," Coste máximo ",-1))])])]),s("div",{class:"d-grid justify-content-center w-100 m-2"},[s("button",{onClick:S,class:"btn btn-primary btn-lg py-3 fw-medium"}," Reservar ahora ")])])])])])]),w(g)],64)}}},vt=ls(et,[["__scopeId","data-v-e0aaa865"]]);export{vt as default};
