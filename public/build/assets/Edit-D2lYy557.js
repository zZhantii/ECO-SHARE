import{l as D,q as I,C as j,E as z,b as a,h as l,j as n,d,v as e,n as m,f as _,F as u,i as p,z as P,o as r,t as v}from"./app-pebjqkCD.js";import{s as $}from"./index.esm-C_1aiQ0x.js";import{e as q}from"./yup-locales.esm-DRsOkZ6u.js";import{u as A}from"./reserves-B7Ti7RoC.js";import{u as K}from"./users-BKl8x4eE.js";import{u as M}from"./trips-BVbkd_tG.js";import{u as G}from"./vehicles-hQAbVoZ-.js";const H={class:"surface-ground px-4 py-5 md:px-6 lg:px-8"},J={class:"grid"},O={class:"col-12 md:col-8 md:col-offset-2 lg:col-6 lg:col-offset-3"},Q={class:"surface-card p-4 shadow-2 rounded-4"},W={key:0},X={class:"mb-4"},Y={key:0,class:"p-error block mt-1"},Z={class:"mb-4"},ee={key:0,class:"p-error block mt-1"},te={class:"mb-4"},se={class:"p-inputgroup"},oe={key:0,class:"p-error block mt-1"},le={class:"mb-4"},ae={key:0,class:"p-error block mt-1"},re={class:"mb-4"},ie={key:0,class:"p-error block mt-1"},ne={class:"mb-4"},de={class:"p-inputgroup"},ue={key:0,class:"p-error block mt-1"},ce={class:"flex justify-content-end"},ye={__name:"Edit",setup(me){$(q);const f=j(),k=P(),{updateReserve:U,getReserve:R,reserve:i,reserveSchema:S,validationErrors:o}=A(),{getUsers:E,users:F}=K(),{getTrips:C,tripsList:T}=M(),{getVehicle:h,vehicle:y}=G(),b=D(null),B=async()=>{await h(i.value.vehicle_id),b.value=y.value.pax_number};I(async()=>{await R(f.params.user_id,f.params.trip_id),await E(),await C()}),z(()=>i.value.vehicle_id,async c=>{await h(c),b.value=y.value.pax_number});const L=async()=>{try{await S.validate(i.value.pivot,{abortEarly:!1}).then(()=>{U(i)}).then(()=>{k.push({name:"reserves.index"})})}catch(c){c.inner&&(o.value={},c.inner.forEach(t=>{o.value[t.path]||(o.value[t.path]=[]),o.value[t.path].push(t.message)}))}};return(c,t)=>{const V=_("Select"),x=_("InputNumber"),w=_("DatePicker"),g=_("Button"),N=_("Toast");return r(),a(u,null,[l("div",H,[l("div",J,[l("div",O,[l("div",Q,[t[13]||(t[13]=l("div",{class:"text-center mb-5"},[l("h2",{class:"text-3xl font-medium text-900 mb-3"},"Editar Reserva"),l("span",{class:"text-600 font-medium"},"Modifique los datos de la reserva")],-1)),e(i)&&e(i).pivot?(r(),a("div",W,[l("div",X,[t[7]||(t[7]=l("label",{for:"reserve.user_id",class:"block text-900 font-medium mb-2"},"Usuario",-1)),n(V,{modelValue:e(i).user_id,"onUpdate:modelValue":t[0]||(t[0]=s=>e(i).user_id=s),options:e(F).data,filter:"",optionLabel:"name",optionValue:"id",dataKey:"id",placeholder:"Seleccionar Usuario",class:m(["w-full",{"p-invalid":e(o).user_id}])},null,8,["modelValue","options","class"]),e(o).user_id?(r(),a("small",Y,[(r(!0),a(u,null,p(e(o).user_id,s=>(r(),a("div",{key:s},v(s),1))),128))])):d("",!0)]),l("div",Z,[t[8]||(t[8]=l("label",{for:"reserve.pivot.trip_id",class:"block text-900 font-medium mb-2"},"Viaje",-1)),n(V,{modelValue:e(i).pivot.trip_id,"onUpdate:modelValue":[t[1]||(t[1]=s=>e(i).pivot.trip_id=s),B],options:e(T),filter:"",optionLabel:s=>`${s.start_point.address} - ${s.end_point.address}`,optionValue:"id",dataKey:"id",placeholder:"Seleccionar Viaje",class:m(["w-full",{"p-invalid":e(o).trip_id}])},null,8,["modelValue","options","optionLabel","class"]),e(o).trip_id?(r(),a("small",ee,[(r(!0),a(u,null,p(e(o).trip_id,s=>(r(),a("div",{key:s},v(s),1))),128))])):d("",!0)]),l("div",te,[t[9]||(t[9]=l("label",{for:"seats_reserved",class:"block text-900 font-medium mb-2"},"Sitios Reservados",-1)),l("div",se,[n(x,{modelValue:e(i).pivot.seats_reserved,"onUpdate:modelValue":t[2]||(t[2]=s=>e(i).pivot.seats_reserved=s),id:"seats_reserved",min:0,max:b.value,placeholder:"NÃºmero de asientos",class:m(["w-full",{"p-invalid":e(o).seats_reserved}]),showButtons:""},null,8,["modelValue","max","class"])]),e(o).seats_reserved?(r(),a("small",oe,[(r(!0),a(u,null,p(e(o).seats_reserved,s=>(r(),a("div",{key:s},v(s),1))),128))])):d("",!0)]),l("div",le,[t[10]||(t[10]=l("label",{for:"reservation_date",class:"block text-900 font-medium mb-2"},"Fecha de Reserva",-1)),n(w,{modelValue:e(i).pivot.reservation_date,"onUpdate:modelValue":t[3]||(t[3]=s=>e(i).pivot.reservation_date=s),showTime:"",hourFormat:"24",class:m(["w-full",{"p-invalid":e(o).reservation_date}]),showIcon:!0,placeholder:"Seleccionar fecha y hora",dateFormat:"dd/mm/yy"},null,8,["modelValue","class"]),e(o).reservation_date?(r(),a("small",ae,[(r(!0),a(u,null,p(e(o).reservation_date,s=>(r(),a("div",{key:s},v(s),1))),128))])):d("",!0)]),l("div",re,[t[11]||(t[11]=l("label",{for:"check_in",class:"block text-900 font-medium mb-2"},"Check In",-1)),n(w,{modelValue:e(i).pivot.check_in,"onUpdate:modelValue":t[4]||(t[4]=s=>e(i).pivot.check_in=s),showTime:"",hourFormat:"24",class:m(["w-full",{"p-invalid":e(o).check_in}]),showIcon:!0,placeholder:"Seleccionar fecha y hora",dateFormat:"dd/mm/yy"},null,8,["modelValue","class"]),e(o).check_in?(r(),a("small",ie,[(r(!0),a(u,null,p(e(o).check_in,s=>(r(),a("div",{key:s},v(s),1))),128))])):d("",!0)]),l("div",ne,[t[12]||(t[12]=l("label",{for:"total_price",class:"block text-900 font-medium mb-2"},"Precio Total",-1)),l("div",de,[n(x,{modelValue:e(i).pivot.total_price,"onUpdate:modelValue":t[5]||(t[5]=s=>e(i).pivot.total_price=s),id:"total_price",minFractionDigits:2,maxFractionDigits:2,placeholder:"0.00",class:m(["w-full",{"p-invalid":e(o).total_price}]),mode:"currency",currency:"EUR",locale:"es-ES"},null,8,["modelValue","class"])]),e(o).total_price?(r(),a("small",ue,[(r(!0),a(u,null,p(e(o).total_price,s=>(r(),a("div",{key:s},v(s),1))),128))])):d("",!0)]),l("div",ce,[n(g,{label:"Cancelar",class:"p-button-text mr-2",onClick:t[6]||(t[6]=s=>e(k).back())}),n(g,{label:"Actualizar",icon:"pi pi-check",class:"p-button-success",loading:c.loading,onClick:L},null,8,["loading"])])])):d("",!0)])])])]),n(N)],64)}}};export{ye as default};
