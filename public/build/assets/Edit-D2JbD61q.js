import{aw as le,J as ae,l as b,q as ne,C as ie,b as l,h as e,j as f,w as R,f as k,t as u,v as r,G as y,H as re,d as F,n as de,F as c,i as h,M as C,z as ue,o as a}from"./app-pebjqkCD.js";import{u as ce}from"./roles-DJfErgU2.js";import{u as me}from"./users-BKl8x4eE.js";const pe={class:"grid"},ve={class:"col-12 md:col-4 lg:col-4 xl:col-4"},ge={class:"card mb-0"},_e={class:"card-body"},fe={class:"account-settings"},he={class:"user-profile"},be={class:"user-avatar"},ye={class:"flex flex-wrap justify-content-between align-items-center flex-1 gap-2"},xe={class:"flex gap-2"},we=["alt","src"],Ue={key:1},ke=["alt","src"],Ce={class:"flex justify-content-center align-items-center"},Se=["src","alt"],Ve={class:"user-name"},ze={class:"user-email"},Re={class:"about"},Ee={class:"form-group"},Le={class:"text-right"},Me=["disabled"],Te={class:""},je={key:0},Be={key:1},$e={class:"col-12 md:col-8 lg:col-8 xl:col-8"},De={class:"card mb-3"},Pe={class:"card-body"},Ae={key:0},Ie={class:"form-group"},Ne={class:"text-danger mt-1"},Fe={class:"form-group"},Ge={class:"text-danger mt-1"},qe={class:"form-group"},He={class:"text-danger mt-1"},Je={class:"form-group"},Ke={class:"text-danger mt-1"},Oe={class:"form-group"},Qe={class:"text-danger mt-1"},We={class:"form-group"},Xe={class:"text-danger mt-1"},to={__name:"Edit",setup(Ye){const G=le(),E=ae(),{roleList:q,getRoleList:H}=ce(),{updateUser:J,getUser:K,user:d,validationErrors:m,isLoading:V}=me(),O=ie(),Q=ue(),n=b(null),x=b([]),L=b("https://bootdey.com/img/Content/avatar/avatar7.png");ne(async()=>{var s,o,p,v,g,w,S;await H(),await K(O.params.id),n.value=d.value,(p=(o=(s=d.value)==null?void 0:s[0])==null?void 0:o.roles)!=null&&p[0]&&(x.value=[d.value[0].roles[0].id],console.log("Role set to:",x.value)),(S=(w=(g=(v=d.value)==null?void 0:v[0])==null?void 0:g.media)==null?void 0:w[0])!=null&&S.original_url&&(L.value=d.value[0].media[0].original_url)});const W=s=>{console.log("Role changed to:",s.value),n.value&&n.value[0]&&(n.value[0].roles=[{id:s.value}])},X=async()=>{try{await J(n.value,x.value),Q.back(),E.add({severity:"success",summary:"Success",detail:"Usuario actualizado correctamente",life:3e3})}catch{E.add({severity:"error",summary:"Error",detail:"Error al actualizar el usuario",life:3e3})}},M=b(0),Y=b(0),T=b([]),Z=s=>{console.log("onBeforeUpload"),s.formData.append("id",d.value[0].id)},ee=s=>{console.log("onSelectedFiles"),T.value=s.files,s.files.length>1&&(s.files=s.files.splice(0,s.files.length-1)),T.value.forEach(o=>{M.value+=parseInt(se(o.size))})},oe=async(s,o)=>{console.log("uploadEvent"),Y.value=M.value/10,await s()},te=s=>{console.log("onTemplatedUpload"),console.log(s)},se=s=>{const v=G.config.locale.fileSizeTypes;if(s===0)return`0 ${v[0]}`;const g=Math.floor(Math.log(s)/Math.log(1024));return`${parseFloat((s/Math.pow(1024,g)).toFixed(3))} ${v[g]}`};return(s,o)=>{var j,B,$,D,P,A,I;const p=k("Button"),v=k("FileUpload"),g=k("MultiSelect"),w=k("InputText"),S=k("Toast");return a(),l(c,null,[e("div",pe,[e("div",ve,[e("div",ge,[e("div",_e,[e("div",fe,[e("div",he,[e("div",be,[f(v,{name:"picture",url:"/api/users/updateimg",onBeforeUpload:Z,onUpload:o[0]||(o[0]=t=>te(t)),accept:"image/*",maxFileSize:15e5,onSelect:ee,"pt:content:class":"fu-content","pt:buttonbar:class":"fu-header","pt:root:class":"fu",class:"fu"},{header:R(({chooseCallback:t,uploadCallback:i,clearCallback:N,files:U,uploadedFiles:_})=>[e("div",ye,[e("div",xe,[f(p,{onClick:z=>t(),icon:"pi pi-images",rounded:"",outlined:""},null,8,["onClick"]),f(p,{onClick:z=>oe(i,_),icon:"pi pi-cloud-upload",rounded:"",outlined:"",severity:"success",disabled:!U||U.length===0},null,8,["onClick","disabled"]),f(p,{onClick:z=>N(),icon:"pi pi-times",rounded:"",outlined:"",severity:"danger",disabled:!U||U.length===0},null,8,["onClick","disabled"])]),o[8]||(o[8]=e("p",{class:"mt-4 mb-0"},"Drag and drop files to here to upload.",-1))])]),content:R(({files:t,uploadedFiles:i,removeUploadedFileCallback:N,removeFileCallback:U})=>[t.length>0?(a(!0),l(c,{key:0},h(t,(_,z)=>(a(),l("img",{key:_.name+_.type+_.size,role:"presentation",alt:_.name,src:_.objectURL,class:"object-fit-cover w-100 h-100 img-profile"},null,8,we))),128)):(a(),l("div",Ue,[i.length>0?(a(),l("img",{key:i[i.length-1].name+i[i.length-1].type+i[i.length-1].size,role:"presentation",alt:i[i.length-1].name,src:i[i.length-1].objectURL,class:"object-fit-cover w-100 h-100 img-profile"},null,8,ke)):F("",!0)]))]),empty:R(()=>{var t,i;return[e("div",Ce,[e("img",{src:L.value,alt:((i=(t=r(d).value)==null?void 0:t[0])==null?void 0:i.name)||"Default Avatar",class:"object-fit-cover w-100 h-100 img-profile"},null,8,Se)])]}),_:1})]),e("h5",Ve,u(r(d).name),1),e("h6",ze,u(r(d).email),1)]),e("div",Re,[e("div",Ee,[o[9]||(o[9]=e("label",{for:"roles"},"Roles",-1)),f(g,{id:"roles",modelValue:x.value,"onUpdate:modelValue":o[1]||(o[1]=t=>x.value=t),options:r(q),optionLabel:"name",optionValue:"id",placeholder:"Selecciona los roles",class:"w-100",maxSelectedLabels:1,selectionLimit:1,onChange:W},null,8,["modelValue","options"])]),e("div",Le,[e("button",{disabled:r(V),class:"btn btn-primary w-100",onClick:X},[y(e("div",Te,null,512),[[re,r(V)]]),r(V)?(a(),l("span",je,"Processing...")):(a(),l("span",Be,"Guardar"))],8,Me)])])])])])]),e("div",$e,[e("div",De,[e("div",Pe,[o[16]||(o[16]=e("h6",{class:"mb-2 text-primary"},"Personal Details",-1)),n.value?(a(),l("div",Ae,[e("div",Ie,[o[10]||(o[10]=e("label",{for:"name"},"Nombre",-1)),f(w,{modelValue:n.value[0].name,"onUpdate:modelValue":o[2]||(o[2]=t=>n.value[0].name=t),type:"text",class:de(["form-control",{"is-invalid":(j=r(m))==null?void 0:j.name}]),id:"name"},null,8,["modelValue","class"]),e("div",Ne,[(a(!0),l(c,null,h((B=r(m))==null?void 0:B.name,t=>(a(),l("div",null,u(t),1))),256))])]),e("div",Fe,[o[11]||(o[11]=e("label",{for:"surname1"},"Apellido 1",-1)),y(e("input",{"onUpdate:modelValue":o[3]||(o[3]=t=>n.value[0].surname1=t),type:"text",class:"form-control",id:"surname1"},null,512),[[C,n.value[0].surname1]]),e("div",Ge,[(a(!0),l(c,null,h(($=r(m))==null?void 0:$.surname1,t=>(a(),l("div",null,u(t),1))),256))])]),e("div",qe,[o[12]||(o[12]=e("label",{for:"surname2"},"Apellido 2",-1)),y(e("input",{"onUpdate:modelValue":o[4]||(o[4]=t=>n.value[0].surname2=t),type:"text",class:"form-control",id:"surname2"},null,512),[[C,n.value[0].surname2]]),e("div",He,[(a(!0),l(c,null,h((D=r(m))==null?void 0:D.surname2,t=>(a(),l("div",null,u(t),1))),256))])]),e("div",Je,[o[13]||(o[13]=e("label",{for:"alias"},"Alias",-1)),y(e("input",{"onUpdate:modelValue":o[5]||(o[5]=t=>n.value[0].alias=t),type:"text",class:"form-control",id:"alias"},null,512),[[C,n.value[0].alias]]),e("div",Ke,[(a(!0),l(c,null,h((P=r(m))==null?void 0:P.alias,t=>(a(),l("div",null,u(t),1))),256))])]),e("div",Oe,[o[14]||(o[14]=e("label",{for:"email"},"Email",-1)),y(e("input",{"onUpdate:modelValue":o[6]||(o[6]=t=>n.value[0].email=t),type:"email",class:"form-control",id:"email"},null,512),[[C,n.value[0].email]]),e("div",Qe,[(a(!0),l(c,null,h((A=r(m))==null?void 0:A.email,t=>(a(),l("div",null,u(t),1))),256))])]),e("div",We,[o[15]||(o[15]=e("label",{for:"password"},"Password",-1)),y(e("input",{"onUpdate:modelValue":o[7]||(o[7]=t=>n.value[0].password=t),type:"password",class:"form-control",id:"password"},null,512),[[C,n.value[0].password]]),e("div",Xe,[(a(!0),l(c,null,h((I=r(m))==null?void 0:I.password,t=>(a(),l("div",null,u(t),1))),256))])])])):F("",!0)])])])]),f(S)],64)}}};export{to as default};
