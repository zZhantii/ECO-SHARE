import{l as c,P as ge,z as xe,I as Ve,J as we,p as ke,q as Ce,b as q,h as a,j as l,w as m,f as p,v,V as _e,o as f,y as $,e as k,d as N,t as C,N as B,F as Ue,i as Ee}from"./app-pebjqkCD.js";import{u as Pe}from"./users-BKl8x4eE.js";import{s as ee}from"./index-LWFa1mRE.js";import{u as Ae}from"./vehicles-hQAbVoZ-.js";import{c as ae,a as S,b as De}from"./index.esm-C_1aiQ0x.js";import{D as je}from"./DropZone-D3dxynPT.js";import{_ as Ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./yup-locales.esm-DRsOkZ6u.js";function Te(){const F=c({name:"",email:""});xe();const x=c({}),i=c(!1),_=ge("$swal");return{profile:F,getProfile:async()=>{F.value=auth.user.value},updateProfile:async V=>{i.value||(i.value=!0,x.value={},axios.put("/api/user",V).then(({data:b})=>{b.success&&_({icon:"success",title:"Perfil actualizado con éxito"})}).catch(b=>{var y;(y=b.response)!=null&&y.data&&(x.value=b.response.data.errors)}).finally(()=>i.value=!1))},deleteImage:async()=>{(await axios.delete("/api/delete-avatar")).data.success&&_({icon:"success",title:"Imagen de perfil eliminada con éxito."})},validationErrors:x,isLoading:i,uploadAvatar:async(V,b)=>{if(i.value)return;i.value=!0,x.value={},console.log(V.value);let y=new FormData;y.append("avatar",V.value),axios.post("/api/user-avatar",y,{headers:{"content-type":"multipart/form-data"}}).then(U=>{_({icon:"success",title:"Avatar cambiado satisfactoriamente"}),b.value.avatar=U.data.data.media[0].original_url}).catch(U=>{var z;(z=U.response)!=null&&z.data&&(x.value=U.response.data.errors)}).finally(()=>i.value=!1)}}}const $e={id:"tab-pannel",class:"bg-white"},Ne={class:"p-0 col-11 d-flex justify-content-center"},Se={class:"container"},ze={class:"mt-4 col-11 d-block d-md-flex gap-3"},Le={class:"gap-4 col-none-11 col-md-9"},qe={class:"fs-2 mb-5"},Be={class:"gap-3 w-100"},Fe={class:"container d-flex flex-column mt-5 justify-content-center col-none-11 col-md-9"},Me={class:"d-flex align-items-center justify-content-between gap-3"},Ge={class:"w-50"},Xe={class:"d-flex align-items-center justify-content-between gap-3"},Re={class:"w-50 mb-3"},Je={class:"d-flex align-items-center justify-content-between gap-3"},Qe={class:"w-50 mb-4"},Ze={class:"d-flex justify-content-between"},He={class:"flex items-center gap-4 mb-4"},Ke={class:"flex items-center gap-4 mb-4"},Oe={class:"flex items-center gap-4 mb-4"},We={class:"flex items-center gap-4 mb-8"},Ye={class:"flex justify-end gap-2"},he={class:"flex items-center gap-4 mb-4"},ea={class:"flex items-center gap-4 mb-4"},aa={class:"flex justify-end gap-2"},la={class:"ms-5 mt-3 ms-5 d-flex flex-column align-items-center"},sa=["onClick"],ta={key:1,class:"text-center"},oa={class:"flex items-center gap-4 mb-4"},na={class:"flex items-center gap-4 mb-4"},ia={class:"flex items-center gap-4 mb-4"},ua={class:"flex items-center gap-4 mb-4"},ra={class:"d-flex justify-content-between align-items-end"},da={class:"flex items-center gap-4 mb-4"},ma={class:"d-flex flex-column"},va={class:"flex items-center gap-4 mb-4"},pa={class:"flex items-center gap-4 mb-4"},ca={class:"flex items-center gap-4 mb-4"},fa={class:"flex items-center gap-4 mb-4"},ba={class:"flex items-center gap-4 mb-8"},ya={class:"d-flex flex-column"},ga={class:"flex justify-end gap-2"},xa={__name:"index",setup(F){const x=Ve(),i=we(),{updateProfile:_,deleteImage:X,uploadAvatar:R}=Te(),{user:u}=Pe(),{getVehicles:M,createVehicle:V,vehicle:b,vehiclesList:y,updateVehicle:U,deleteVehicle:z,vehicleSchema:J}=Ae(),I=c(null),w=c(!1),E=c(!1),P=c(!1),A=c(!1),D=c(!1),o=c({}),Q=["Gasolina","Diésel"],j=c(""),L=c(""),s=c({}),le=ae().shape({id:De().required(),alias:S().required(),name:S().required("El campo nombre es obligatorio"),surname1:S().required("El primer apellido es obligatorio"),email:S().email().required("El correo electrónico es obligatorio")}),se=ae().shape({password:S().required("La contraseña es obligatoria").min(8,"La contraseña debe tener al menos 8 carácteres")}),te=ke(()=>w.value?`${u.surname1??""} ${u.surname2??""}`:o.value.surname2==null?`${o.value.surname1}`:`${o.value.surname1} ${o.value.surname2}`);Ce(async()=>{o.value={...u.value},M()});const oe=r=>{x.require({target:r.currentTarget,message:"¿Estás seguro/a que quieres eliminar este vehículo?",icon:"pi pi-info-circle",rejectProps:{label:"Cancelar",severity:"secondary",outlined:!0},acceptProps:{label:"Eliminar",severity:"danger"},accept:()=>{r.user_id=null,z(r),E.value=!1},reject:()=>{i.add({verity:"info",summary:"Eliminación cancelada",detail:"El vehiculo no se ha eliminado",life:3e3}),console.log("El vehiculo no se ha eliminado.")}})};function ne(){s.value={...b.value},A.value=!0}function ie(r){E.value=!0,s.value={...y.value.find(e=>e.id==r)}}async function ue(){try{await J.validate({plate:s.value.plate,brand:s.value.brand,model:s.value.model,consumption:s.value.consumption,fuel_type:s.value.fuel_type,pax_number:s.value.pax_number}),V(s),A.value=!1}catch(r){console.log(r),i.add({severity:"info",summary:"Faltan datos o los formatos no son adecuados.",detail:r.message,life:3e3})}}async function re(){if(j.value!=""&&j.value==L.value)try{o.value.password=j.value;let r={value:o.value.password};await se.validate({password:r.value}),i.add({severity:"success",summary:"Contraseña actualizada",detail:"La contraseña ha sida cambiada con éxito.",life:3e3}),_(o.value),u.value={...o.value},P.value=!1}catch(r){i.add({severity:"info",summary:"La contraseña debe tener mínimo 8 caracteres",detail:r.message,life:3e3})}else i.add({severity:"info",summary:"Contraseñas diferentes",detail:"Las contraseñas no coinciden",life:3e3})}function de(){I.value?(R(I,u),D.value=!1,I.value=null):i.add({severity:"info",summary:"No se ha cambiado la imagen.",detail:"No se ha podido cambiar la imagen de perfil porque no hay ninguna seleccionada.",life:3e3})}async function me(){try{await le.validate({id:o.value.id,alias:o.value.alias,name:o.value.name,surname1:o.value.surname1,email:o.value.email}),i.add({severity:"success",summary:"Perfil actualizado",detail:"Los datos del perfil han sido actualizados con éxito.",life:3e3}),_(o.value),u.value={...o.value},w.value=!1}catch(r){i.add({severity:"info",summary:"Faltan datos o los datos son incorrectos.",detail:r.message,life:3e3})}}function Z(){w.value=!1,o.value={...u.value},s.value={...b.value},j.value="",L.value="",P.value=!1}function ve(){X(),u.value.avatar=null,D.value=!1}async function pe(){try{console.log(s.value),await J.validate({plate:s.value.plate,brand:s.value.brand,model:s.value.model,consumption:s.value.consumption,fuel_type:s.value.fuel_type,pax_number:s.value.pax_number}),U(s),E.value=!1}catch(r){i.add({severity:"info",summary:"Faltan datos o los formatos no son adecuados.",detail:r.message,life:3e3})}}return(r,e)=>{const H=p("Tab"),ce=p("TabList"),K=p("Avatar"),d=p("Button"),T=p("Dialog"),g=p("InputText"),O=p("TabPanel"),W=p("SelectButton"),G=p("InputNumber"),fe=p("ConfirmPopup"),Y=p("Message"),be=p("TabPanels"),ye=p("Tabs");return f(),q("main",$e,[e[58]||(e[58]=a("div",{class:"container col-6"},[a("h1",{class:"fs-2 mb-2 mt-4 text-center"},"Perfil del usuario")],-1)),a("div",Ne,[l(ye,{class:"col-none-11 col-md-6 mt-5",value:"0"},{default:m(()=>[l(ce,{class:"ms-4 col-11"},{default:m(()=>[l(H,{class:"col-none-5 col-md-8 color-og fs-5 p-2",value:"0"},{default:m(()=>e[29]||(e[29]=[$("Información personal")])),_:1}),l(H,{class:"col-none-5 col-md-8 color-og fs-5 p-2",value:"1",onClick:v(M)},{default:m(()=>e[30]||(e[30]=[$("Gestionar vehículos")])),_:1},8,["onClick"])]),_:1}),l(be,{class:"mt-2"},{default:m(()=>[l(O,{value:"0"},{default:m(()=>{var t,h;return[a("div",Se,[a("div",ze,[a("div",Le,[(t=v(u))!=null&&t.avatar?(f(),k(K,{key:0,image:v(u).avatar,class:"mr-2 mb-3 avatar",size:"xlarge",shape:"circle"},null,8,["image"])):(f(),k(K,{key:1,label:(h=v(u).alias)==null?void 0:h.charAt(0).toUpperCase(),image:v(u).avatar,class:"mr-2 mb-3 avatar",size:"xlarge",style:{"background-color":"#ece9fc",color:"#2a1261"}},null,8,["label","image"])),a("p",qe,[a("strong",null,C(v(u).alias),1)]),l(d,{label:"Cambiar imagen de perfil",class:"btn-secondary",icon:"pi pi-plus",onClick:e[0]||(e[0]=n=>D.value=!0)}),D.value?(f(),k(T,{key:2,visible:D.value,"onUpdate:visible":e[2]||(e[2]=n=>D.value=n),header:"Editar imagen de perfil",style:{width:"25rem"}},{default:m(()=>[l(je,{class:"mb-5 mt-5 d-flex",modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=n=>I.value=n)},null,8,["modelValue"]),a("div",Be,[l(d,{label:"Subir imagen",class:"btn-primary me-5",onClick:de}),l(d,{onClick:ve,label:"Quitar imagen",class:"btn-secondary"})])]),_:1},8,["visible"])):N("",!0)]),a("div",Fe,[e[42]||(e[42]=a("div",null,null,-1)),a("div",Me,[e[31]||(e[31]=a("label",{class:"w-50 mb-3",for:""},"Nombre",-1)),a("p",Ge,[a("strong",null,C(v(u).name),1)])]),a("div",Xe,[e[32]||(e[32]=a("label",{class:"w-50",for:""},"Apellidos",-1)),a("p",Re,[a("strong",null,C(te.value),1)])]),a("div",Je,[e[33]||(e[33]=a("label",{class:"w-50",for:""},"Correo Electrónico",-1)),a("p",Qe,[a("strong",null,C(v(u).email),1)])]),a("div",Ze,[l(d,{class:"mt-3 me-2 btn-primary",label:"Editar datos personales",onClick:e[3]||(e[3]=n=>(w.value=!0,o.value.value={...v(u).value}))}),l(d,{class:"mt-3 btn-secondary",label:"Cambiar contraseña",onClick:e[4]||(e[4]=n=>P.value=!0)})]),w.value?(f(),k(T,{key:0,visible:w.value,"onUpdate:visible":e[9]||(e[9]=n=>w.value=n),modal:"",header:"Editar perfil",style:{width:"40rem"}},{default:m(()=>[a("form",{onSubmit:B(me,["prevent"])},[e[38]||(e[38]=a("span",{class:"text-surface-500 dark:text-surface-400 block mb-8"},"Edita tu información personal.",-1)),a("div",He,[e[34]||(e[34]=a("label",{for:"name",class:"font-semibold w-25"},"Nombre",-1)),l(g,{modelValue:o.value.name,"onUpdate:modelValue":e[5]||(e[5]=n=>o.value.name=n),id:"name",class:"flex-auto",autocomplete:"off"},null,8,["modelValue"])]),a("div",Ke,[e[35]||(e[35]=a("label",{for:"surname1",class:"font-semibold w-25"},"Primer apellido",-1)),l(g,{modelValue:o.value.surname1,"onUpdate:modelValue":e[6]||(e[6]=n=>o.value.surname1=n),id:"surname1",class:"flex-auto",autocomplete:"off"},null,8,["modelValue"])]),a("div",Oe,[e[36]||(e[36]=a("label",{for:"surname2",class:"font-semibold w-25"},"Segundo apellido",-1)),l(g,{modelValue:o.value.surname2,"onUpdate:modelValue":e[7]||(e[7]=n=>o.value.surname2=n),id:"surname2",class:"flex-auto",autocomplete:"off"},null,8,["modelValue"])]),a("div",We,[e[37]||(e[37]=a("label",{for:"email",class:"font-semibold w-25"},"Email",-1)),l(g,{modelValue:o.value.email,"onUpdate:modelValue":e[8]||(e[8]=n=>o.value.email=n),id:"email",class:"flex-auto",autocomplete:"off"},null,8,["modelValue"])]),a("div",Ye,[l(d,{type:"button",label:"Cancelar",severity:"secondary",onClick:Z}),l(d,{type:"submit",label:"Guardar",class:"btn-primary"})])],32)]),_:1},8,["visible"])):N("",!0),P.value?(f(),k(T,{key:1,visible:P.value,"onUpdate:visible":e[12]||(e[12]=n=>P.value=n),modal:"",header:"Cambiar contraseña",style:{width:"25rem"}},{default:m(()=>[a("form",{onSubmit:B(re,["prevent"])},[e[41]||(e[41]=a("span",{class:"text-surface-500 dark:text-surface-400 block mb-8"},"Actualiza la contraseña.",-1)),a("div",he,[e[39]||(e[39]=a("label",{for:"pwd1",class:"font-semibold w-24"},"Nueva contraseña",-1)),l(v(ee),{modelValue:j.value,"onUpdate:modelValue":e[10]||(e[10]=n=>j.value=n),min:"8",toggleMask:"",weakLabel:"Demasiado simple"},null,8,["modelValue"])]),a("div",ea,[e[40]||(e[40]=a("label",{for:"pwd2",class:"font-semibold w-24"},"Repite la contraseña",-1)),l(v(ee),{modelValue:L.value,"onUpdate:modelValue":e[11]||(e[11]=n=>L.value=n),min:"8",toggleMask:"",weakLabel:"Demasiado simple"},null,8,["modelValue"])]),a("div",aa,[l(d,{type:"button",label:"Cancelar",severity:"secondary",onClick:Z}),l(d,{type:"submit",label:"Guardar"})])],32)]),_:1},8,["visible"])):N("",!0)])])])]}),_:1}),l(O,{value:"1"},{default:m(()=>[a("div",null,[a("ul",la,[v(y).length>0?(f(!0),q(Ue,{key:0},Ee(v(y),t=>(f(),q("li",{key:t.id,onClick:()=>ie(t.id),class:"primary-a ms-5 w-50 mb-3 d-flex justify-content-between align-items-center gap-5"},[$(C(t.brand.toUpperCase())+" - "+C(t.model.toUpperCase())+" ("+C(t.plate.toUpperCase())+")",1),e[43]||(e[43]=a("i",{class:"fas fa-ellipsis-v"},null,-1))],8,sa))),128)):(f(),q("h2",ta," No tienes vehículos registrados ")),E.value==!0?(f(),k(T,{key:2,visible:E.value,"onUpdate:visible":e[19]||(e[19]=t=>E.value=t),modal:"",header:"Editar vehículo",style:{width:"40rem"}},{default:m(()=>[a("form",{onSubmit:e[18]||(e[18]=B(t=>pe(s.value.id),["prevent"]))},[e[48]||(e[48]=a("span",{class:"text-surface-500 dark:text-surface-400 block mb-8"},"Edita los datos de tu vehículo",-1)),a("div",oa,[e[44]||(e[44]=a("label",{for:"name",class:"font-semibold w-25"},"Marca",-1)),l(g,{modelValue:s.value.brand,"onUpdate:modelValue":e[13]||(e[13]=t=>s.value.brand=t),class:"flex-auto",autocomplete:"off"},null,8,["modelValue"])]),a("div",na,[e[45]||(e[45]=a("label",{for:"name",class:"font-semibold w-25"},"Modelo",-1)),l(g,{modelValue:s.value.model,"onUpdate:modelValue":e[14]||(e[14]=t=>s.value.model=t),class:"flex-auto",autocomplete:"off"},null,8,["modelValue"])]),a("div",ia,[e[46]||(e[46]=a("label",{for:"name",class:"font-semibold w-25"},"Combustible",-1)),l(W,{modelValue:s.value.fuel_type,"onUpdate:modelValue":e[15]||(e[15]=t=>s.value.fuel_type=t),options:Q,"aria-labelledby":"basic"},null,8,["modelValue"])]),a("div",ua,[e[47]||(e[47]=a("label",{for:"name",class:"font-semibold w-25"},"Plazas",-1)),l(G,{modelValue:s.value.pax_number,"onUpdate:modelValue":e[16]||(e[16]=t=>s.value.pax_number=t),inputId:"integeronly",min:1,max:5,showButtons:""},null,8,["modelValue"])]),a("div",ra,[l(d,{label:"Guardar",class:"btn-primary mt-3",type:"submit"}),l(fe),l(d,{onClick:e[17]||(e[17]=()=>oe(s.value)),class:"h-100",label:"Eliminar",icon:"fa fa-trash",severity:"danger",outlined:""})])],32)]),_:1},8,["visible"])):N("",!0),l(d,{label:"Añadir vehículo",class:"btn-primary mt-3",onClick:ne})]),A.value?(f(),k(T,{key:0,visible:A.value,"onUpdate:visible":e[28]||(e[28]=t=>A.value=t),modal:"",header:"Añadir vehiculo",style:{width:"50rem"}},{default:m(()=>[a("form",{onSubmit:e[27]||(e[27]=B(t=>ue(),["prevent"]))},[e[57]||(e[57]=a("span",{class:"text-surface-500 dark:text-surface-400 block mb-8"},"Introduce los datos para registrar tu vehículo",-1)),a("div",da,[e[50]||(e[50]=a("label",{for:"plate",class:"font-semibold w-25"},"Matrícula del vehículo",-1)),a("div",ma,[l(g,{modelValue:s.value.plate,"onUpdate:modelValue":e[20]||(e[20]=t=>s.value.plate=t),id:"plate",class:"flex-auto",autocomplete:"off"},null,8,["modelValue"]),l(Y,{size:"small",severity:"secondary",variant:"simple"},{default:m(()=>e[49]||(e[49]=[$("Introduce la matrícula con formato XXXX000 sin guiones")])),_:1})])]),a("div",va,[e[51]||(e[51]=a("label",{for:"brand",class:"font-semibold w-25"},"Marca",-1)),l(g,{modelValue:s.value.brand,"onUpdate:modelValue":e[21]||(e[21]=t=>s.value.brand=t),id:"brand",class:"flex-auto",autocomplete:"off"},null,8,["modelValue"])]),a("div",pa,[e[52]||(e[52]=a("label",{for:"brand",class:"font-semibold w-25"},"Modelo",-1)),l(g,{modelValue:s.value.model,"onUpdate:modelValue":e[22]||(e[22]=t=>s.value.model=t),id:"brand",class:"flex-auto",autocomplete:"off"},null,8,["modelValue"])]),a("div",ca,[e[53]||(e[53]=a("label",{for:"consumption",class:"font-semibold w-25"},"Consumo de combustible",-1)),l(G,{modelValue:s.value.consumption,"onUpdate:modelValue":e[23]||(e[23]=t=>s.value.consumption=t),inputId:"minmaxfraction",minFractionDigits:1,maxFractionDigits:1,showButtons:""},null,8,["modelValue"])]),a("div",fa,[e[54]||(e[54]=a("label",{for:"fuel_type",class:"font-semibold w-25"},"Tipo de combustibles",-1)),l(W,{modelValue:s.value.fuel_type,"onUpdate:modelValue":e[24]||(e[24]=t=>s.value.fuel_type=t),options:Q,"aria-labelledby":"basic",class:""},null,8,["modelValue"])]),a("div",ba,[e[56]||(e[56]=a("label",{for:"pax_number",class:"font-semibold w-25"},"Número de plazas",-1)),a("div",ya,[l(G,{modelValue:s.value.pax_number,"onUpdate:modelValue":e[25]||(e[25]=t=>s.value.pax_number=t),inputId:"integeronly",min:1,max:5,showButtons:""},null,8,["modelValue"]),l(Y,{size:"small",severity:"secondary",variant:"simple"},{default:m(()=>e[55]||(e[55]=[$("Sólo las disponibles para pasajeros, sin contar al conductor")])),_:1})])]),a("div",ga,[l(d,{type:"button",label:"Cancelar",severity:"secondary",onClick:e[26]||(e[26]=t=>A.value=!1)}),l(d,{label:"Guardar",type:"submit"})])],32)]),_:1},8,["visible"])):N("",!0)])]),_:1})]),_:1})]),_:1})]),l(v(_e))])}}},Aa=Ie(xa,[["__scopeId","data-v-871ebca0"]]);export{Aa as default};
